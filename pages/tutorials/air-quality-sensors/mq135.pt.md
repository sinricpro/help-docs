---
title: Construa um Sensor de Qualidade do Ar com Sensor MQ135 para detectar fumaça e outros gases nocivos para Alexa
layout: post
lang: pt
---

Nesta seção, vamos orientá-lo na criação de um sensor de qualidade do ar usando **ESP32** ou **ESP8266**. Você então poderá visualizar a qualidade do ar via **Amazon Alexa** e **receber uma notificação push via aplicativo Sinric Pro** quando a qualidade do ar ficar abaixo de um certo nível limite.

### Pré-requisitos:

1. ESP32, ESP8266 x 1.
2. MQ135 x 1.
3. Cabos Jumper.

![Sinric Pro MQ135 air quality]({{ site.github.url }}/public/img/sinricpro-air-quality-intro.png)

### Introdução rápida ao MQ135

O MQ135 é um sensor de gás semicondutor que é comumente usado em equipamentos de controle de qualidade do ar. É sensível a uma ampla gama de gases, incluindo amônia, sulfeto, benzeno e fumaça. O sensor tem duas saídas: uma saída digital que fica alta quando a concentração de gás excede um certo limite, e uma saída analógica que fornece uma tensão proporcional à concentração de gás.

O sensor MQ135 requer uma fonte de alimentação de 5V e consome cerca de 150mA de corrente. A saída digital pode ser conectada a um ESP32, ESP8266 ou Pico W para medir a concentração de gás.

**Como calibrar o sensor?**
Coloque seu sensor do lado de fora onde há ar fresco suficiente (idealmente a 20°C e 33% de umidade de acordo com a folha de dados) e deixe-o ligado por 12-24 horas para queimá-lo e estabilizar.

Folha de especificação: [SNS-MQ135](https://www.olimex.com/Products/Components/Sensors/Gas/SNS-MQ135/resources/SNS-MQ135.pdf)

### Fiação

![Sinric Pro esp8266 PIR wiring]({{ site.github.url }}/public/img/sinricpro_mq135-wiring-diagram.png) 


| MCU       | Pino A0                   |  Pino VCC |
| --------- | -------                   | -------   |
| ESP32     |    34 (Analog ADC1_CH6)   |   5V      |
| ESP8266   |    A0                     |   5V/VIN  |
| Pico W    |    GP26 (ADC0)            |   5V      |
 


**Nota:** no ESP32, ADC2 (GPIO04, GPIO02, GPIO15) é instável quando Wi-Fi está sendo usado.

Vamos verificar se o sensor de movimento está conectado corretamente e funcionando.

<script src="https://gist.github.com/kakopappa/8222c51084122bd9f6b195cb878ae070.js"></script>

O Monitor Serial do Arduino IDE mostrará as detecções de movimento assim:

![Sinric Pro mq135 test reading]({{ site.github.url }}/public/img/sinricpro_mq135-test-reading.png)

### Detectando Qualidade do Ar Ruim

<script src="https://gist.github.com/kakopappa/941db2518842c85b95a388592ad6cd3b.js"></script>

 
### Passo 1: Conectar ao Sinric Pro

#### Passo 1.1: Criando um tipo de dispositivo personalizado para Sensor de Qualidade do Ar.

Sinric Pro não tem um tipo de dispositivo integrado para Sensor de Qualidade do Ar com PPM, então vamos criar um tipo de dispositivo personalizado para Sensor de Água usando o recurso Device Template para conseguir.

1. Valor PPM

2. Qualidade do Ar é Severa, Muito Ruim, Ruim, Moderada ou Boa.

**Nota**: Você pode usar o recurso de importação de template de dispositivo mencionado abaixo para pular a criação do template completo.

* [Faça login](https://portal.sinric.pro/devicetemplates/new) na sua conta Sinric Pro e vá para **Device Templates**

* Clique em **Add Device Template**. Digite nome e descrição como **Air Quality Sensor** e selecione **Air Quality Sensor** como tipo de dispositivo

![Sinric Pro air quality ensor device template]({{ site.github.url }}/public/img/sinricpro-air-quality-sensor-device-template-basic-info.png) 

* Clique em **Capabilities**.

Aqui devemos selecionar as características do nosso Sensor de Qualidade do Ar. Queremos saber se a *Qualidade do Ar* é *Severa, Muito Ruim, Ruim, Moderada ou Boa*. Então vamos arrastar uma capacidade **Range**, **Mode** e **Push Notification**.

![Sinric Pro custom device type for capacitive soil moisture sensor]({{ site.github.url }}/public/img/capacitive-air-quality-set-template-drop-range-mode.png) 

- O que é capacidade Range?

  A capacidade Range pode ser usada para representar um número. ex: velocidade atual de um liquidificador.

- O que é capacidade Mode?

  A capacidade Mode pode ser usada para representar um valor de uma lista de valores predefinidos. ex: modo de ciclo de lavagem atual de uma máquina de lavar.

- O que é capacidade Push Notification?

  A capacidade Notification fornece a habilidade de enviar uma mensagem de notificação push do código.

Clique no botão **Configure** e configure as duas capacidades como abaixo.

![Sinric Pro moisture sensor template mode and range settings]({{ site.github.url }}/public/img/sinricpro-air-quality-device-template-range-and-mode.png)  

Clique em **Save** para salvar.

![Sinric Pro moisture sensor template mode and range settings]({{ site.github.url }}/public/img/sinricpro-air-quality-sensor-template-range-and-mode-configured.png)  

Clique em **Save** para salvar o template.

Agora você pode ver o template que acabamos de criar.


## Importar um template existente?

Se você está com preguiça de configurar todos os Modos e valores Range, você pode usar o recurso de importação.

![Sinric Pro capacitive soil moisture sensor import template]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-import-template.png)

Cole este Template:

<script src="https://gist.github.com/kakopappa/4c4b48081f5602f166e18f96dfa1b6bd.js"></script>

* [Faça login](http://portal.sinric.pro) na sua conta Sinric Pro, vá ao menu **Dispositivos** à esquerda e clique no botão **Adicionar Dispositivo** (no canto superior esquerdo).

* Digite o nome do dispositivo **Sensor de Qualidade do Ar**, descrição **Sensor de Qualidade do Ar** e selecione o tipo de dispositivo como **Air Quality Sensor** de **Your Device Templates**.


![Sinric Pro create device alexa]({{ site.github.url }}/public/img/sinricpro-air-quality-sensor-new-device-select-template.png)

![Sinric Pro create device alexa]({{ site.github.url }}/public/img/sinricpro-air-quality-sensor-device-new-device-info.png)

* Clique na aba Outros e Clique em **Salvar**

* A próxima tela mostrará as credenciais necessárias para conectar o dispositivo que você acabou de criar.

![Sinric Pro copy device id]({{ site.github.url }}/public/img/sinric-pro-create-custom-device-keys.png)

* Copie o **ID do Dispositivo**, **Chave do App** e **Segredo do App** ***Mantenha esses valores seguros. NÃO OS COMPARTILHE EM FÓRUNS PÚBLICOS!***

* Clique em **Code Generator** para Gerar o código. Clique em **Download** para baixar o código.

![Sinric Pro copy device id]({{ site.github.url }}/public/img/sinric-pro-create-custom-device-code-download.png)
 

### Passo 2: Conectar ao Sinric Pro

#### Passo 2.1 Instalar a Biblioteca Sinric Pro

![Sinric Pro install SinricPro library]({{ site.github.url }}/public/img/sinricpro_arduinoIDE-library-manager.png)

#### Passo 2.2 Instalar TroykaMQ

TroykaMQ não está disponível no Arduino Library Manager. Então você deve baixá-lo de [https://github.com/amperka/TroykaMQ](https://github.com/amperka/TroykaMQ) e copiá-lo para `C:\Users\<seu nome de usuário>\Documents\Arduino\libraries`

#### 2.2 Código Completo

 <script src="https://gist.github.com/kakopappa/462f5f2504edf04134265ce7999028c0.js"></script>
 
Agora você deve conseguir ver o status de inundação e nível de água via Alexa, App Sinric Pro

Alexa, Qual é a qualidade do ar (nome do modo) no sensor de qualidade do ar(nome do dispositivo)

Alexa, Qual é o ppm (nome do range) no sensor de qualidade do ar(nome do dispositivo)


![Sinric Pro Alexa capacitive soil moisture sensor]({{ site.github.url }}/public/img/sinricpro-air-quality-sensor-alexa.jpg)
 
![Sinric Pro Alexa capacitive soil moisture sensor portal]({{ site.github.url }}/public/img/sinricpro-air-quality-device-portal.png)
 

### Solução de Problemas
1. Google Home ou SmartThings não são suportados.

2. Consulte nossa página de [Solução de Problemas]({{ site.github.url }}/pt/pages/troubleshooting.pt.html) para mais detalhes.
 
> Este documento é código aberto. Viu um erro de digitação? Por favor, crie uma [issue](https://github.com/sinricpro/help-docs)