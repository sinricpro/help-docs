---
title: Como construir um Sensor de Umidade do Solo Capacitivo (HW-390) para ESP8266, ESP32, Raspberry Pi Pico W para Alexa
layout: post
lang: pt
---
 
Nesta parte, vamos orientá-lo na construção de um **Sensor de Umidade do Solo Capacitivo** que pode ser conectado a um **ESP32, ESP8266 ou Raspberry Pi Pico W**. Uma vez configurado, você poderá verificar o nível de umidade do solo usando Amazon Alexa, perguntar à Alexa sobre informações dele, e também monitorá-lo através do aplicativo Sinric Pro e enviar uma **notificação push quando a umidade do solo estiver seca ou úmida**.


![Sinric Pro HW-390 capacitive soil moisture sensor ]({{ site.github.url }}/public/img/HW-390-capacitive-soil-moisture-sensor-intro.jpg)

### Pré-requisitos:

1. ESP32, ESP8266 ou Raspberry Pi Pico W x 1.
2. Sensor de Umidade do Solo Capacitivo (HW-390) x 1.
3. Planta com vaso x 1.
4. Cabos Jumper.

**Nota:** no ESP32, ADC2 (GPIO04, GPIO02, GPIO15) é instável quando Wi-Fi está sendo usado.

### Introdução rápida ao Sensor de Umidade do Solo Capacitivo

Sensores de umidade do solo capacitivos medem a resistência elétrica entre duas sondas. A resistência muda dependendo da quantidade de água no solo. O sensor é conectado a um microcontrolador (MCU), que mede a capacitância entre as sondas. O circuito HW-390 converte a medição de capacitância para um sinal de tensão (ADC), que é então enviado para o MCU. O MCU pode usar este sinal para exibir o nível de umidade do solo ou para controlar outros dispositivos.
 
**Nota:** Fertilizantes e corrosão podem reduzir a precisão do sensor ao longo do tempo.
  
### Fiação do Sensor de Umidade do Solo Capacitivo

![Sinric Pro HW-390 esp8266 capacitive soil moisture sensor wiring]({{ site.github.url }}/public/img/HW-390-capacitive-soil-moisture-sensor-wiring.png) 


| MCU       | Pino GPIO    |
| --------- | ------- |
| ESP32     |    34 (Analog ADC1_CH6)   |
| ESP8266   |    A0   |
| Pico W    |    GP26 (ADC0)  |

Vamos verificar se o sensor está conectado corretamente e funcionando.

```c++
#if defined(ESP8266)
  const int adcPin = A0;  
#elif defined(ESP32) 
  const int adcPin = 34;  
#elif defined(ARDUINO_ARCH_RP2040)
  const int adcPin = 26;  
#endif

void setup() {
  Serial.begin(9600);
  pinMode(adcPin, INPUT);
}

void loop() {
 Serial.println(analogRead(adcPin)); 
 delay(1000);
}
```
![HW-390 capacitive soil moisture sensor arduino readings]({{ site.github.url }}/public/img/HW-390-capacitive-soil-moisture-sensor-test-readings.png) 

Vamos converter a entrada analógica para um valor de porcentagem.

```c++
#if defined(ESP8266)
  const int adcPin = A0;  
#elif defined(ESP32) 
  const int adcPin = 34;  
#elif defined(ARDUINO_ARCH_RP2040)
  const int adcPin = 26;  
#endif

const int DRY = 720; // TODO: Este é o valor quando o solo está seco. Ajuste de acordo com seu caso de uso
const int WET = 560; // TODO: Este é o valor quando o solo está úmido. Ajuste de acordo com seu caso de uso

void setup() {
  Serial.begin(9600);
  pinMode(adcPin, INPUT);
}

void loop() {
 int sensorVal = analogRead(adcPin);
 int percentage = map(sensorVal, WET, DRY, 100, 0); 
 Serial.printf("Valor do sensor: %d porcentagem: %d%%\r\n", sensorVal, percentage); 
 
 delay(1000);
}
```

![Sinric Pro moisture sensor esp8266 readings]({{ site.github.url }}/public/img/HW-390-capacitive-soil-moisture-sensor-test-readings-as-precentage.png) 

 
### Passo 1: Conectar ao Sinric Pro

#### Passo 1.1: Criando um tipo de dispositivo personalizado para Sensor de Umidade do Solo Capacitivo.

Sinric Pro não tem um tipo de dispositivo integrado para Sensor de Umidade do Solo Capacitivo, então vamos criar um tipo de dispositivo personalizado para Sensor de Umidade do Solo Capacitivo usando o recurso Device Template para ver.

1. Solo está **Úmido** ou **Seco**

2. Nível de umidade.

**Nota**: Você pode usar o recurso de importação de template de dispositivo mencionado abaixo para pular a criação do template completo.

* [Faça login](https://portal.sinric.pro/devicetemplates/new) na sua conta Sinric Pro e vá para **Device Templates**

* Clique em **Add Device Template**. Digite nome e descrição como **Capacitive Soil Moisture Sensor** e selecione **Capacitive Soil Moisture Sensor** como tipo de dispositivo

![Sinric Pro capacitive soil moisture sensor device template]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-set-template-name-desc-type.png) 

* Clique em **Capabilities**.

Aqui devemos selecionar as características do nosso Sensor de Umidade do Solo. Queremos saber se o *Solo está Úmido ou Seco* e o *Nível de umidade*. Então vamos arrastar uma capacidade **Range**, **Mode** e **Push Notification**.

![Sinric Pro custom device type for capacitive soil moisture sensor]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-set-template-drop-range-mode.png) 

- O que é capacidade Range?

  A capacidade Range pode ser usada para representar um número. ex: velocidade atual de um liquidificador.

- O que é capacidade Mode?

  A capacidade Mode pode ser usada para representar um valor de uma lista de valores predefinidos. ex: modo de ciclo de lavagem atual de uma máquina de lavar.

- O que é capacidade Push Notification?

  A capacidade Notification fornece a habilidade de enviar uma mensagem de notificação push do código.

Clique no botão **Configure** e configure as duas capacidades como abaixo.

![Sinric Pro moisture sensor template mode and range settings]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-set-template-mode-range-settings.png)  

Clique em **Save** para salvar.

![Sinric Pro moisture sensor template mode and range settings]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-set-template-saved-modes-range.png)  

Clique em **Save** para salvar o template.

![Sinric Pro moisture saved template]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-saved-template.png)  

Agora você pode ver o template que acabamos de criar.


## Importar um template existente?

Se você está com preguiça de configurar todos os valores dos Modos e Range, você pode usar o recurso de importação.

![Sinric Pro capacitive soil moisture sensor import template]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-import-template.png)

Cole este Template:

<script src="https://gist.github.com/kakopappa/8898c16da58fc544c77f9beac89ba53a.js"></script>
 

* [Faça login](http://portal.sinric.pro) na sua conta Sinric Pro, vá ao menu **Dispositivos** à esquerda e clique no botão **Adicionar Dispositivo** (no canto superior esquerdo).

* Digite o nome do dispositivo **Jardim**, descrição **Meu Jardim** e selecione o tipo de dispositivo como **Capacitive Soil Moisture Sensor**.

![Sinric Pro create device alexa]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-save-device.png)

* Clique na aba Outros e Clique em **Salvar**

* A próxima tela mostrará as credenciais necessárias para conectar o dispositivo que você acabou de criar.

![Sinric Pro copy device id]({{ site.github.url }}/public/img/sinric-pro-create-custom-device-keys.png)

* Copie o **ID do Dispositivo**, **Chave do App** e **Segredo do App** ***Mantenha esses valores seguros. NÃO OS COMPARTILHE EM FÓRUNS PÚBLICOS!***

* Clique em **Code Generator** para Gerar o código. Clique em **Download** para baixar o código.

![Sinric Pro copy device id]({{ site.github.url }}/public/img/sinric-pro-create-custom-device-code-download.png)
 

### Passo 2: Conectar ao Sinric Pro

#### Passo 2.1 Instalar a Biblioteca Sinric Pro

![Sinric Pro install SinricPro library]({{ site.github.url }}/public/img/sinricpro_arduinoIDE-library-manager.png)

#### 2.2 Código Completo

<script src="https://gist.github.com/kakopappa/50ae7f8e6a30c46fea1845ee72a7593a.js"></script>


 
Agora você deve conseguir ver a umidade do solo via Alexa, App Sinric Pro


Alexa, Qual é a umidade (nome do modo) no jardim(nome do dispositivo)

Alexa, Qual é o nível de umidade(nome do range) no jardim(nome do dispositivo)


![Sinric Pro Alexa water sensor]({{ site.github.url }}/public/img/sinricpro-water-sensor-alexa.jpg)
 
![Sinric Pro portal]({{ site.github.url }}/public/img/capacitive-soil-moisture-sensor-portal.png)
 

### Solução de Problemas
1. Google Home ou SmartThings não são suportados.

2. Consulte nossa página de [Solução de Problemas]({{ site.github.url }}/pt/pages/troubleshooting.pt.html) para mais detalhes.
 
> Este documento é código aberto. Viu um erro de digitação? Por favor, crie uma [issue](https://github.com/sinricpro/help-docs)